# AI 项目概览初始化规则

> **注意**：本文件定义 AI 如何引导用户完善项目概览信息。

**适用场景**：
- 用户说"初始化项目概览"、"完善项目信息"、"更新架构描述"等
- 检测到 `ai-overview.md` 存在但内容不完整（标记为"需要完善"）
- 用户要求 AI 帮助完善架构描述、模块职责等复杂信息

**必须与以下规范配合使用**：
- `.aodw/06-project/ai-overview.md`（项目概览文件）
- `.aodw/06-project/modules-index.yaml`（模块索引）
- `.aodw/01-core/ai-knowledge-rules.md`（知识维护规则）

---

## 1. 触发条件

当用户表达以下意图时，AI 必须执行项目概览完善流程：

**明确命令**：
- "初始化项目概览"
- "完善项目信息"
- "更新架构描述"
- "完善模块职责"
- "更新项目概览"

**隐含意图**：
- "AI 帮我完善一下项目信息"
- "架构描述不完整，帮我补充"
- "模块信息需要更新"

---

## 2. 执行流程

### Step 1: 读取现有信息

AI 必须：
1. 读取 `.aodw/06-project/ai-overview.md`
2. 读取 `.aodw/06-project/modules-index.yaml`
3. 识别哪些内容是自动检测的（标记为 `<!-- AUTO-DETECTED -->`）
4. 识别哪些内容是用户手动添加的（标记为 `<!-- USER-ADDED -->`）
5. 识别哪些内容需要完善（标记为"待补充"或缺失）

### Step 2: 确定初始化模式

AI 必须先判断当前项目状态：
1. 检查根目录是否为空（排除 `.aodw` 和隐藏文件）
2. 检查关键文件（`package.json`, `pom.xml`, `requirements.txt`, `src` 目录等）

**分支 A：接手老项目（检测模式）**
- **判定条件**：检测到现有代码或配置文件。
- **AI 行为**：
  1. 自动扫描代码结构。
  2. 识别技术栈和依赖关系。
  3. 填充 `ai-overview.md` 的草稿。
  4. 引导用户确认检测结果。

**分支 B：全新空项目（设计模式）**
- **判定条件**：目录为空或仅包含 AODW 初始文件。
- **AI 行为**：
  1. 启动"架构师访谈模式"。
  2. 询问用户意图："由于是新项目，请问您打算构建什么系统？采用什么技术栈？"
  3. 根据用户回答，生成建议的 `ai-overview.md`（作为设计蓝图）。
  4. 协助规划基础目录结构（Scaffolding）。

### Step 3: 引导用户完善

AI 必须按照以下顺序引导用户完善信息：

#### 3.1 技术栈确认

**如果技术栈部分不完整**：
- AI 读取 CLI 检测到的技术栈
- 询问用户确认或补充：
  ```
  检测到的技术栈：
  - 前端：React 18.3.0、TypeScript 5.0.0
  - 后端：FastAPI 0.104.0、Python 3.11
  
  请确认是否正确，或补充缺失的信息：
  ```

#### 3.2 架构概览

**如果架构概览部分为空或标记为"待补充"**：
- AI 基于技术栈和目录结构生成架构图建议
- 引导用户确认或修改：
  ```
  基于项目结构，建议的架构概览：
  
  ```text
  [ Web Client (React) ]
           |
        [ API Gateway (FastAPI) ]
           |
   [ Services / Domain ]
           |
        [ PostgreSQL / Redis ]
  ```
  
  请确认是否符合您的架构，或提供修改建议。
  ```

#### 3.3 模块职责

**如果模块职责部分不完整**：
- AI 读取 `modules-index.yaml` 中的模块列表
- 对于每个模块，AI 分析代码结构，生成职责建议
- 引导用户确认或补充：
  ```
  检测到模块：user、order、payment
  
  基于代码分析，建议的模块职责：
  
  ### user 模块
  - **职责**：用户认证、授权、用户资料管理
  - **关键路径**：backend/app/users/**
  - **依赖关系**：被 order、payment 模块调用
  
  请确认或补充每个模块的职责和约束。
  ```

#### 3.4 系统级 Invariants

**如果 Invariants 部分为空或标记为"待补充"**：
- AI 基于代码分析生成初始约束建议
- 引导用户确认或添加：
  ```
  基于代码结构分析，建议的系统级约束：
  
  - 不得绕过 service 层直接访问 DB
  - 不得无故更改对外 API 返回格式
  - 不得在热路径引入明显的性能退化
  
  请确认或补充其他约束。
  ```

#### 3.5 历史关键变更

**如果历史变更部分为空**：
- AI 询问用户是否有重要的架构演进里程碑
- 引导用户记录：
  ```
  是否有重要的架构演进里程碑需要记录？
  例如：
  - 2025-01：引入新订单系统
  - 2025-03：从单体拆分为微服务
  
  如有，请提供时间和描述。
  ```

### Step 4: 更新文件

AI 必须：
1. 将用户确认的信息更新到 `ai-overview.md`
2. 标记用户添加的内容为 `<!-- USER-ADDED -->`
3. 更新 `modules-index.yaml`（如有模块信息变更）
4. 确保格式符合模板要求

---

## 3. 交互格式

AI 必须遵循 `ai-interaction-rules.md` 中的交互规范：

**问题格式**：
```
Q1. [问题描述]

A. [选项1]（推荐）
B. [选项2]
C. [选项3]

Recommended: A（理由：...）

请回复：A/B/C
```

**确认格式**：
```
检测到以下信息：
- [信息1]
- [信息2]

请确认是否正确，或提供修改建议。
```

---

## 4. 内容标记规范

### 自动检测的内容
```markdown
<!-- AUTO-DETECTED: 以下内容由 aodw init-overview 自动检测 -->
- 前端：React 18.3.0
- 后端：FastAPI 0.104.0
<!-- END AUTO-DETECTED -->
```

### 用户手动添加的内容
```markdown
<!-- USER-ADDED: 以下内容由用户手动添加 -->
- 数据库：PostgreSQL 15（使用连接池，最大连接数 100）
<!-- END USER-ADDED -->
```

### AI 引导完善的内容
```markdown
<!-- AI-ENHANCED: 以下内容由 AI 引导用户完善 -->
- 架构概览：[架构图]
<!-- END AI-ENHANCED -->
```

---

## 5. 更新策略

### 保留原则
1. **保留用户内容**：所有标记为 `<!-- USER-ADDED -->` 的内容必须保留
2. **更新检测内容**：标记为 `<!-- AUTO-DETECTED -->` 的内容可以更新
3. **完善待补充内容**：标记为"待补充"的内容由 AI 引导用户完善

### 冲突处理
当用户手动修改的内容与检测结果冲突时：
1. AI 必须显示差异
2. AI 必须询问用户如何处理
3. AI 必须等待用户确认后再更新

---

## 6. 完成标准

项目概览完善完成的标准：
- [ ] 技术栈信息完整且准确
- [ ] 架构概览已描述或提供架构图
- [ ] 目录结构已列出关键目录
- [ ] 核心业务模块职责已描述
- [ ] 系统级 Invariants 已列出
- [ ] 模块 README 映射表已建立
- [ ] 历史关键变更已记录（如有）

---

## 7. 注意事项

1. **不要覆盖用户内容**：所有用户手动添加的内容必须保留
2. **逐步完善**：不要一次性要求用户完善所有信息，可以分步骤进行
3. **提供建议**：AI 应该基于代码分析提供建议，而不是只询问用户
4. **格式规范**：确保生成的内容符合 `ai-overview.md` 的模板格式
5. **及时更新**：当项目结构发生变化时，提醒用户运行 `aodw init-overview` 更新

---

## 8. 与 CLI 命令的关系

- **CLI 命令**（`aodw init-overview`）：负责自动检测和生成基础信息
- **AI 规则**（本文件）：负责引导用户完善复杂信息（架构描述、模块职责等）

两者配合使用：
1. 用户运行 `aodw init-overview` 生成基础信息
2. 用户运行"初始化项目概览"命令，AI 引导完善详细信息





### Step 5: 完成后的下一步

完成项目概览后，AI 必须强烈建议用户进行工具初始化：

```markdown
✅ 项目概览初始化完成！

⚠️ 下一步建议（重要）：
**执行工具初始化**
由于我们已经确定了项目技术栈，现在请运行：
`aodw init-tools` 或告诉 AI "初始化工具"

这将根据 ai-overview.md 中的技术栈，为您自动配置：
- 前端：ESLint / Prettier (基于 React/Vue)
- 后端：Ruff / Black / Maven (基于 Python/Java)
```
