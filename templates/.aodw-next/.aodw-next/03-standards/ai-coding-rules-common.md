# AI Coding Rules - Common Standards

> **注意**：本文件是 `.aodw/03-standards/ai-coding-rules.md` 的子规范文件。  
> 请先阅读主文件了解通用编码原则，再阅读本文件了解通用编码规范。

**适用场景**：
- 所有类型的代码开发（前端、后端、脚本等）
- 文件大小和复杂度控制
- 代码拆分原则
- 输出策略

---

## 1. 全局文件长度限制（软上限）

为了防止代码库变得难以维护，AI 必须严格遵守以下文件长度限制。

当文件接近以下限制时，AI **必须** 停止向该文件添加新功能，并考虑拆分。

- **TS/TSX/JS 页面组件 (Page)**：建议 ≤ 250 行（软上限 300 行）
- **TS/TSX 业务组件 (Business)**：建议 ≤ 200 行
- **TS/TSX 展示组件 (Display)**：建议 ≤ 150 行
- **Python 模块**：≤ 300 行（普通业务模块建议 ≤ 250 行）
- **Shell 脚本**：≤ 150 行
- **SQL / JSON / YAML / 配置文件**：≤ 200 行（或大小 < 20KB）

---

## 2. 函数 / 方法 / 类限制

- **单个函数/方法**：建议 ≤ 40 行，**最多 ≤ 60 行**。
  - *Action*：如超过 60 行，必须拆分为多个小函数。
- **单个类**：建议 ≤ 300 行。
  - *Action*：如超过需按职责拆类或拆模块。
- **JSX 结构**：超过 80 行或嵌套过深时，必须拆成子组件。

---

## 3. 拆分原则 (Splitting Principle)

当你（AI）意识到继续实现会导致文件超出上述限制时，必须执行以下 **Stop & Ask** 流程：

1. **立刻停止**继续往这个文件里加内容。
2. **主动说明**需要新建哪些文件（组件 / hooks / services / 子模块）来分担职责。
3. **分步实现**：当前对话只实现一个核心文件，其余留待后续迭代。

---

## 4. 输出策略 (Output Strategy)

对于中大型功能（或预计代码量 > 100 行）：

1. **目录结构先行**：
   - 第一步必须给出 **目录结构 + 文件列表 + 各文件职责说明**（不写具体代码）。
   - 在得到用户确认前，**不要**直接生成完整实现。

2. **单次单文件**：
   - 每次对话只生成 **一个文件** 的完整代码。
   - 必须按如下格式标明路径与职责：

   ```tsx
   // path: src/pages/ProjectEditorPage/index.tsx
   // 职责：负责项目编辑页面的整体布局和组件组合，不包含复杂业务逻辑
   <代码...>
   ```

---

## 5. 复杂度控制

- **圈复杂度 (Cyclomatic Complexity)**：建议 ≤ 10
- **认知复杂度 (Cognitive Complexity)**：建议 ≤ 15

如果复杂度超过限制，必须：
1. 重构代码，降低复杂度
2. 拆分函数或类
3. 提取公共逻辑

---

## 6. 代码质量检查

在提交代码前，必须确保：

- [ ] 文件大小符合限制
- [ ] 函数/方法长度符合限制
- [ ] 复杂度符合限制
- [ ] 代码已通过静态检查工具（ESLint、Ruff 等）
- [ ] 代码已通过格式化工具（Prettier、Black 等）
